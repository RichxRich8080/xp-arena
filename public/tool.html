<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Engine â€¢ XP ARENA</title>
    <link rel="stylesheet" href="css/rebirth.css">
    <link rel="stylesheet" href="assets/fontawesome/css/all.min.css">
    <style>
        .engine-container {
            padding: 8rem 2rem 10rem;
            max-width: 1000px;
            margin: 0 auto;
        }

        .engine-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .engine-header h1 {
            font-size: 4rem;
            line-height: 1;
            margin-bottom: 1rem;
        }

        .engine-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
        }

        .personalization-card {
            max-height: 500px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--glass-border) transparent;
        }

        .personalization-card::-webkit-scrollbar {
            width: 6px;
        }

        .personalization-card::-webkit-scrollbar-thumb {
            background-color: var(--glass-border);
            border-radius: 10px;
        }

        .palette-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 10px;
            margin-top: 1.5rem;
        }

        .palette-item {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .palette-item:hover {
            transform: scale(1.1);
        }

        .palette-item.active {
            border-color: #fff;
            box-shadow: 0 0 10px var(--item-glow);
        }

        .input-card {
            background: var(--nebula);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 2.5rem;
        }

        .section-label {
            font-size: 0.7rem;
            color: var(--stardust-muted);
            text-transform: uppercase;
            letter-spacing: 0.2rem;
            margin-bottom: 1.5rem;
            display: block;
        }

        .input-group {
            margin-bottom: 2rem;
        }

        .input-group label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--stardust);
        }

        .input-rebirth {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            padding: 1rem 1.2rem;
            border-radius: var(--radius-sm);
            color: var(--stardust);
            font-family: inherit;
            transition: all 0.3s var(--transition);
        }

        .input-rebirth:focus {
            outline: none;
            border-color: var(--photon);
            box-shadow: 0 0 15px var(--photon-glow);
        }

        /* Suggestion List */
        #deviceSuggestions {
            background: var(--nebula-solid);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-sm);
            margin-top: 0.5rem;
            max-height: 250px;
            overflow-y: auto;
            display: none;
            position: absolute;
            width: calc(100% - 3rem);
            z-index: 100;
        }

        .suggestion-item {
            padding: 1rem;
            cursor: pointer;
            border-bottom: 1px solid var(--glass-border);
            transition: background 0.2s;
        }

        .suggestion-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--photon);
        }

        .suggestion-item span {
            display: block;
            font-size: 0.7rem;
            color: var(--stardust-muted);
        }

        /* Slider */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 4px;
            background: var(--glass-border);
            border-radius: 10px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--photon);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px var(--photon-glow);
            border: 4px solid var(--void);
        }

        .slider-val {
            float: right;
            font-family: 'Clash Display', sans-serif;
            color: var(--photon);
        }

        /* Segmented Control */
        .segmented-control {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            background: rgba(0, 0, 0, 0.2);
            padding: 0.4rem;
            border-radius: var(--radius-sm);
            border: 1px solid var(--glass-border);
        }

        .segment-btn {
            background: transparent;
            border: none;
            padding: 0.8rem 0.5rem;
            border-radius: 8px;
            color: var(--stardust-muted);
            font-size: 0.7rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.3s var(--transition);
        }

        .segment-btn.active {
            background: var(--photon);
            color: var(--void);
            box-shadow: 0 0 15px var(--photon-glow);
        }

        .segment-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.05);
            color: var(--stardust);
        }

        /* Tactile Input */
        .tactile-input-wrap {
            position: relative;
            display: flex;
            align-items: center;
        }

        .tactile-input-wrap input {
            text-align: center;
            font-family: 'Clash Display', sans-serif;
            font-weight: 700;
            font-size: 1.2rem;
            letter-spacing: 0.1em;
        }

        .tactile-ctrl {
            width: 40px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            color: var(--stardust);
            cursor: pointer;
            transition: all 0.2s;
        }

        .tactile-ctrl:hover {
            color: var(--photon);
            background: rgba(255, 255, 255, 0.1);
        }

        .tactile-ctrl.minus {
            border-radius: 8px 0 0 8px;
        }

        .tactile-ctrl.plus {
            border-radius: 0 8px 8px 0;
        }

        /* Context Message Overlay */
        .context-msg {
            margin-top: 1rem;
            font-size: 0.75rem;
            color: var(--stardust-muted);
            line-height: 1.5;
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.02);
            border-left: 2px solid var(--photon);
            min-height: 45px;
            display: flex;
            align-items: center;
            transition: all 0.3s;
        }

        /* Premium Lock */
        .premium-lock-overlay {
            position: absolute;
            inset: 0;
            background: rgba(10, 11, 14, 0.8);
            backdrop-filter: blur(4px);
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            border: 1px solid var(--gold);
        }

        .lock-icon {
            font-size: 1.5rem;
            color: var(--gold);
            margin-bottom: 0.5rem;
        }

        @media (max-width: 600px) {
            .engine-grid {
                grid-template-columns: 1fr;
            }

            .engine-header h1 {
                font-size: 2.5rem;
            }
        }
    </style>
</head>

<body>
    <div class="engine-container">
        <header class="engine-header">
            <span class="section-label">Neural Calibration Sub-System</span>
            <h1 class="clash">PRECISION<br><span class="text-photon">ENGINE</span></h1>
            <p style="color: var(--stardust-muted); max-width: 500px; margin: 0 auto;">
                Synchronize your device hardware with our neural algorithms to achieve a 1:1 aiming response.
            </p>
        </header>

        <div class="engine-grid">
            <!-- Left: Hardware Parameters -->
            <div class="input-card">
                <span class="section-label">Hardware Profile</span>

                <div class="input-group" style="position: relative;">
                    <label><i class="fas fa-mobile-alt" style="margin-right: 8px;"></i> Device Identifier</label>
                    <input type="text" id="deviceSearch" class="input-rebirth"
                        placeholder="Search device database (e.g. iPhone 15)">
                    <div id="deviceSuggestions"></div>
                    <div id="selectedDeviceDisplay"
                        style="margin-top: 1rem; font-size: 0.8rem; color: var(--photon); font-weight: 700;"></div>

                    <!-- Hidden inputs for logic compatibility -->
                    <input type="hidden" id="selectedBrand">
                    <input type="hidden" id="selectedSeries">
                    <input type="hidden" id="selectedModel">
                </div>

                <div class="input-group">
                    <label><i class="fas fa-memory" style="margin-right: 8px;"></i> Dedicated RAM <span
                            class="slider-val" id="ramVal">8GB</span></label>
                    <input type="range" id="ramSlider" min="2" max="16" step="2" value="8">
                </div>

                <div class="input-group" style="position: relative;">
                    <label><i class="fas fa-mouse-pointer" style="margin-right: 8px;"></i> Tactical DPI</label>
                    <div class="tactile-input-wrap">
                        <button class="tactile-ctrl minus" onclick="stepDPI(-50)"><i class="fas fa-minus"></i></button>
                        <input type="number" id="dpiInput" class="input-rebirth" value="800" step="50" min="100"
                            max="2400" style="border-radius: 0; border-left: none; border-right: none;">
                        <button class="tactile-ctrl plus" onclick="stepDPI(50)"><i class="fas fa-plus"></i></button>
                    </div>

                    <!-- Premium Lock for DPI -->
                    <div class="premium-lock-overlay" id="dpiLock">
                        <i class="fas fa-crown lock-icon"></i>
                        <span
                            style="font-weight: 800; font-size: 0.7rem; color: var(--gold); letter-spacing: 2px;">PREMIUM
                            ONLY</span>
                        <p style="font-size: 0.6rem; color: var(--stardust-muted);">Unlock DPI scaling for
                            ultra-fine-tuning.</p>
                        <button class="btn-rebirth"
                            style="font-size: 0.6rem; margin-top: 10px; padding: 0.5rem 1rem; border-color: var(--gold); color:var(--gold);"
                            onclick="location.href='premium.html'">UPGRADE</button>
                    </div>
                </div>
            </div>

            <!-- Right: Performance Modes -->
            <div class="input-card">
                <span class="section-label">Operational Context</span>

                <div class="input-group">
                    <label>Friction Matrix (Hand/Grip)</label>
                    <div class="segmented-control" id="gripSegments">
                        <button class="segment-btn active" data-value="normal">Standard</button>
                        <button class="segment-btn" data-value="hard">Glass</button>
                        <button class="segment-btn" data-value="fast">Sleeve</button>
                    </div>
                    <input type="hidden" id="handSelect" value="normal">
                    <div class="context-msg" id="gripContext">The standard grip provides a balanced tactile response for
                        consistent tracking.</div>
                </div>

                <div class="input-group">
                    <label>Response Velocity</label>
                    <div class="segmented-control" id="velocitySegments">
                        <button class="segment-btn active" data-value="medium">Balanced</button>
                        <button class="segment-btn" data-value="slow">Precision</button>
                        <button class="segment-btn" data-value="fast">Aggressive</button>
                    </div>
                    <input type="hidden" id="speedSelect" value="medium">
                    <div class="context-msg" id="velocityContext">Balanced velocity ensures optimal stability between
                        micro-adjustments and flicks.</div>
                </div>

                <div class="pulse-card" style="padding: 1.5rem; background: var(--glass-highlight);">
                    <h4 class="clash" style="font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--corona);">AI
                        DIAGNOSTICS</h4>
                    <p style="font-size: 0.75rem; color: var(--stardust-muted); line-height: 1.4;" id="aiStatusMsg">
                        Waiting for calibration sequence initiation...</p>
                </div>

            </div>
            <div style="margin-top: 3rem;">
                <button id="calculateBtn" class="btn-rebirth btn-photon"
                    style="width: 100%; justify-content: center; padding: 1.5rem; font-size: 1.2rem; letter-spacing: 0.2em;">
                    INITIATE CALIBRATION
                </button>
            </div>

            <!-- Pro Presets -->
            <div style="margin-top: 5rem; text-align: center;">
                <span class="section-label">Elite Verified Profiles</span>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center; margin-top: 1.5rem;">
                    <button class="btn-rebirth" onclick="loadProPreset('white444')"
                        style="font-size: 0.75rem; background: var(--nebula); border: 1px solid var(--glass-border); color: var(--stardust);">WHITE444</button>
                    <button class="btn-rebirth" onclick="loadProPreset('nobru')"
                        style="font-size: 0.75rem; background: var(--nebula); border: 1px solid var(--glass-border); color: var(--stardust);">NOBRU</button>
                    <button class="btn-rebirth" onclick="loadProPreset('ruok')"
                        style="font-size: 0.75rem; background: var(--nebula); border: 1px solid var(--glass-border); color: var(--stardust);">RUOK
                        FF</button>
                    <button class="btn-rebirth" onclick="loadProPreset('vincenzo')"
                        style="font-size: 0.75rem; background: var(--nebula); border: 1px solid var(--glass-border); color: var(--stardust);">VINCENZO</button>
                </div>
            </div>
        </div>

        <!-- Layout Scripts -->
        <script src="js/phones.js"></script>
        <script src="js/auth.js"></script>
        <script src="js/user.js"></script>
        <script src="js/layout.js"></script>
        <script src="js/app.js"></script>
        <script>
            // Local Override for real-time UI feel
            document.addEventListener('DOMContentLoaded', () => {
                const ramSlider = document.getElementById('ramSlider');
                const ramVal = document.getElementById('ramVal');
                if (ramSlider && ramVal) {
                    ramSlider.addEventListener('input', () => {
                        ramVal.textContent = ramSlider.value + 'GB';
                    });
                }

                const dpiInput = document.getElementById('dpiInput');
                if (dpiInput) {
                    dpiInput.addEventListener('input', () => {
                        // Optional: feedback
                    });
                }

                // Premium Status Check
                if (typeof User !== 'undefined' && Auth.isLoggedIn()) {
                    const stats = User.getStats();
                    if (stats && stats.is_premium) {
                        const dpiLock = document.getElementById('dpiLock');
                        if (dpiLock) dpiLock.style.display = 'none';
                    }
                }

                // Segmented Controls Logic
                const gripTexts = {
                    'normal': 'Standard grip provides a balanced tactile response for consistent tracking across most surfaces.',
                    'hard': 'Optimized for high-pressure contact on glass surfaces. Minimizes static friction.',
                    'fast': 'Extreme zero-friction profile. Recommended for sleeve-assisted high-velocity movement.'
                };

                const velocityTexts = {
                    'medium': 'Balanced velocity ensures optimal stability between micro-adjustments and quick-flick maneuvers.',
                    'slow': 'Prioritizes fine-motor control for long-range precision. Ideal for low-sens snipers.',
                    'fast': 'Maximizes response rate. Designed for high-sens reflex players requiring instant targets.'
                };

                const setupSegments = (containerId, hiddenInputId, contextId, textMap) => {
                    const container = document.getElementById(containerId);
                    const hiddenInput = document.getElementById(hiddenInputId);
                    const context = document.getElementById(contextId);
                    if (!container || !hiddenInput) return;

                    container.addEventListener('click', (e) => {
                        const btn = e.target.closest('.segment-btn');
                        if (!btn) return;

                        container.querySelectorAll('.segment-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        hiddenInput.value = btn.dataset.value;
                        if (context && textMap) {
                            context.style.opacity = '0';
                            setTimeout(() => {
                                context.textContent = textMap[btn.dataset.value];
                                context.style.opacity = '1';
                            }, 150);
                        }
                    });
                }

                setupSegments('gripSegments', 'handSelect', 'gripContext', gripTexts);
                setupSegments('velocitySegments', 'speedSelect', 'velocityContext', velocityTexts);

                // Color Customizer Logic
                const accentColor = document.getElementById('accentColor');
                const accentHex = document.getElementById('accentHex');

                function updateAccent(color) {
                    document.documentElement.style.setProperty('--photon', color);
                    document.documentElement.style.setProperty('--photon-glow', color + '33');
                    if (accentHex) accentHex.textContent = color.toUpperCase();
                    localStorage.setItem('xp_accent_color', color);

                    // Notify user with new styling
                    if (window.Toast) Toast.show('Neural HUD Resynchronized', 'info');
                }

                if (accentColor) {
                    accentColor.addEventListener('input', (e) => {
                        updateAccent(e.target.value);
                        // Remove active from palette items
                        document.querySelectorAll('.palette-item').forEach(p => p.classList.remove('active'));
                    });
                }

                window.setThemePalette = function (el) {
                    const color = el.getAttribute('data-color');
                    updateAccent(color);
                    if (accentColor) accentColor.value = color;

                    document.querySelectorAll('.palette-item').forEach(p => p.classList.remove('active'));
                    el.classList.add('active');
                };

                // Initialize accent color display
                const savedColor = localStorage.getItem('xp_accent_color') || '#00f5ff';
                if (accentColor) accentColor.value = savedColor;
                if (accentHex) accentHex.textContent = savedColor.toUpperCase();

                // Highlight active palette if it matches
                document.querySelectorAll('.palette-item').forEach(p => {
                    if (p.getAttribute('data-color').toLowerCase() === savedColor.toLowerCase()) {
                        p.classList.add('active');
                    } else {
                        p.classList.remove('active');
                    }
                });
            });



            // --- Diagnostic History Persistence ---
            function updateDiagHistory() {
                const historyEl = document.getElementById('diagHistoryList');
                if (!historyEl) return;

                const lastResults = localStorage.getItem('xp_calc_results');
                if (lastResults) {
                    const data = JSON.parse(lastResults);
                    historyEl.innerHTML = `
                        <div style="padding: 10px; background: rgba(255,255,255,0.03); border-radius: 8px; border: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 700; font-size: 0.8rem; color: var(--stardust);">${data.device}</div>
                                <div style="font-size: 0.7rem; color: var(--photon);">${data.general} GEN | ${data.dpi} DPI</div>
                            </div>
                            <a href="result.html" class="btn-rebirth" style="padding: 4px 8px; font-size: 0.6rem; background: var(--photon); color: var(--void);">VIEW</a>
                        </div>
                    `;
                }
            }

            updateDiagHistory();
        </script>
</body>

</html>