<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Clip ‚Ä¢ XP ARENA</title>
    <meta name="description"
        content="Submit your best gameplay clips to the XP ARENA weekly rankings for a chance to win cash prizes and recognition.">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="assets/fontawesome/css/all.min.css">
</head>

<body class="fade-in">

    <nav class="navbar">
        <!-- Injected by layout.js -->
    </nav>

    <div class="container" style="max-width: 600px;">
        <div class="page-header">
            <h1>Enter Weekly Rankings</h1>
            <p>Submit your best clip to get featured on the global leaderboard.</p>
        </div>

        <div
            style="background: rgba(255, 68, 68, 0.05); border: 1px solid rgba(255, 68, 68, 0.2); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
            <h3 style="color: #ff4444; font-size: 1rem; margin-bottom: 0.8rem;">‚ö†Ô∏è Submission Rules</h3>
            <ul style="list-style-position: inside; color: var(--text-muted); font-size: 0.9rem; line-height: 1.8;">
                <li>No background music (Game sound only)</li>
                <li>Max clip length: 60 seconds</li>
                <li>No cheats/hacks (Instant ban)</li>
                <li>Respectful content only</li>
            </ul>
        </div>

        <div class="form-card" id="submissionArea">
            <div id="authGuard" style="display: none; text-align: center; padding: 2rem 1rem;">
                <div style="font-size: 3rem; margin-bottom: 1.5rem;">üîí</div>
                <h2 style="margin-bottom: 1rem;">Login Required</h2>
                <p style="color: var(--text-muted); margin-bottom: 2rem;">You must be logged in to participate in the
                    weekly rankings and earn AXP.</p>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <a href="login.html" class="btn-primary">LOGIN NOW</a>
                    <a href="signup.html" class="btn-secondary">CREATE ACCOUNT</a>
                </div>
            </div>

            <form action="https://formsubmit.co/umarsa8080@gmail.com" method="POST" id="submissionForm">
                <input type="hidden" name="_subject" value="New Gameplay Submission - XP ARENA">
                <input type="hidden" name="_captcha" value="false">

                <div class="form-group">
                    <label>Gamer Tag (In-Game Name)</label>
                    <input type="text" name="gamertag" id="form-gamertag" placeholder="e.g. ShadowSlayer" required>
                </div>

                <div class="form-group">
                    <label>Game UID</label>
                    <input type="text" name="uid" placeholder="e.g. 12345678" required>
                </div>

                <div class="form-group">
                    <label>WhatsApp Number (For Prize Delivery)</label>
                    <input type="tel" name="whatsapp" placeholder="+234..." required>
                </div>

                <div class="form-group">
                    <label>Clip Link (YouTube/Drive/TikTok)</label>
                    <input type="url" name="clip_url" placeholder="https://..." required>
                </div>

                <button type="submit" class="btn-primary">SUBMIT ENTRY</button>
            </form>
        </div>
    </div>

    <!-- Success Message Overlay -->
    <div class="success-overlay" id="successOverlay">
        <div class="success-icon">‚úÖ</div>
        <h2 class="success-title">Submission Successful!</h2>
        <p class="success-desc">Your clip has been received. Our team will review it, and you might see yourself on the
            leaderboard soon!</p>
        <div style="display: flex; gap: 10px;">
            <button class="btn-primary" onclick="window.location.href='index.html'"
                style="width: auto; padding: 0.8rem 1.5rem;">Go Home</button>
            <button class="btn-secondary" onclick="location.reload()"
                style="width: auto; padding: 0.8rem 1.5rem;">Submit Another</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <!-- Injected by layout.js -->
    </nav>

    <script src="js/auth.js"></script>
    <script src="js/user.js"></script>
    <script src="js/layout.js"></script>
    <script src="js/app.js"></script>
    <script>
        const form = document.getElementById('submissionForm');
        const authGuard = document.getElementById('authGuard');
        const btn = document.querySelector('#submissionForm .btn-primary');
        const overlay = document.getElementById('successOverlay');

        function checkAuth() {
            if (!Auth.isLoggedIn()) {
                if (form) form.style.display = 'none';
                if (authGuard) authGuard.style.display = 'block';
            } else {
                if (form) form.style.display = 'block';
                if (authGuard) authGuard.style.display = 'none';
                const user = Auth.getCurrentUser();
                const gamerTagInput = document.getElementById('form-gamertag');
                if (gamerTagInput && user.username) {
                    gamerTagInput.value = user.username;
                }
            }
        }

        document.addEventListener('DOMContentLoaded', checkAuth);
        window.addEventListener('authChange', checkAuth);

        form.addEventListener('submit', function (e) {
            e.preventDefault();
            btn.innerHTML = "Sending...";
            btn.style.opacity = "0.7";

            const formData = new FormData(form);

            fetch(form.action, {
                method: "POST",
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            })
                .then(response => {
                    if (response.ok) {
                        overlay.classList.add('active');
                        form.reset();
                        if (typeof User !== 'undefined' && typeof Auth !== 'undefined' && Auth.isLoggedIn()) {
                            User.addClip({
                                device: formData.get('gamertag') || 'Mobile Player',
                                url: formData.get('clip_url')
                            });
                        }
                    } else {
                        alert("Oops! There was a problem submitting your form. Please try again.");
                        btn.innerHTML = "SUBMIT ENTRY";
                        btn.style.opacity = "1";
                    }
                })
                .catch(error => {
                    console.error("Submission error:", error);
                    alert("Submission failed. Please check your connection.");
                    btn.innerHTML = "SUBMIT ENTRY";
                    btn.style.opacity = "1";
                });
        });
    </script>
</body>

</html>