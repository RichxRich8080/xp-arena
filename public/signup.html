<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Join the Arena â€¢ XP Arena</title>
    <link rel="stylesheet" href="css/main.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Outfit:wght@700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="assets/fontawesome/css/all.min.css">
    <style>
        body {
            background-color: var(--bg-darker);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
        }

        .auth-container {
            width: 100%;
            max-width: 440px;
            padding: 2rem;
            position: relative;
            z-index: 10;
        }

        .auth-card {
            padding: 3rem 2.5rem;
            text-align: center;
        }

        .brand {
            margin-bottom: 2.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .brand-logo {
            width: 64px;
            height: 64px;
            background: rgba(var(--accent-rgb), 0.1);
            border: 1px solid rgba(var(--accent-rgb), 0.2);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .brand h1 {
            font-family: 'Outfit', sans-serif;
            font-size: 1.5rem;
            font-weight: 900;
            letter-spacing: -0.5px;
            margin: 0;
            color: #fff;
        }

        .auth-header {
            margin-bottom: 2rem;
        }

        .auth-header h2 {
            font-family: 'Outfit', sans-serif;
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .auth-header p {
            color: var(--text-muted);
            font-size: 0.95rem;
        }

        .field {
            text-align: left;
            margin-bottom: 1.5rem;
        }

        .field label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 0.6rem;
        }

        .input-wrap {
            position: relative;
        }

        .input-wrap i {
            position: absolute;
            left: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-dim);
            font-size: 0.9rem;
        }

        .input-wrap input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-stroke);
            border-radius: var(--radius);
            color: #fff;
            font-size: 1rem;
            transition: var(--transition);
        }

        .input-wrap input:focus {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 0 4px rgba(var(--accent-rgb), 0.1);
        }

        .strength-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 2px;
            margin-top: 10px;
            overflow: hidden;
        }

        .strength-fill {
            height: 100%;
            width: 0;
            transition: var(--transition);
        }

        .strength-label {
            font-size: 0.75rem;
            color: var(--text-dim);
            margin-top: 6px;
        }

        .auth-footer {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--glass-stroke);
            font-size: 0.95rem;
            color: var(--text-muted);
        }

        .auth-footer a {
            color: var(--accent);
            font-weight: 700;
            text-decoration: none;
        }

        /* Verification Overlay */
        .verify-overlay {
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: rgba(5, 6, 8, 0.9);
            backdrop-filter: blur(12px);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
        }

        .verify-overlay.active {
            display: flex;
        }

        .verify-card {
            max-width: 400px;
            width: 100%;
            padding: 3rem 2rem;
            text-align: center;
        }

        .code-inputs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 2rem 0;
        }

        .code-input {
            width: 44px;
            height: 56px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-stroke);
            border-radius: 12px;
            font-size: 1.5rem;
            font-weight: 800;
            color: #fff;
            text-align: center;
            transition: var(--transition);
        }

        .code-input:focus {
            border-color: var(--accent);
            background: rgba(255, 255, 255, 0.08);
            outline: none;
        }

        .bg-glow {
            position: fixed;
            top: 0;
            right: 0;
            width: 60vw;
            height: 60vw;
            background: radial-gradient(circle, rgba(var(--accent-rgb), 0.05) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }
    </style>
</head>

<body>
    <div class="bg-glow"></div>

    <div class="verify-overlay" id="verifyOverlay">
        <div class="verify-card glass-card">
            <div style="font-size: 3rem; margin-bottom: 1.5rem;">ðŸ“«</div>
            <h2>Verify Identity</h2>
            <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom: 2rem;">A security code has been
                transmitted to your email. Enter it below to proceed.</p>
            <div class="code-inputs" id="codeInputs">
                <input class="code-input" maxlength="1" type="text" inputmode="numeric">
                <input class="code-input" maxlength="1" type="text" inputmode="numeric">
                <input class="code-input" maxlength="1" type="text" inputmode="numeric">
                <input class="code-input" maxlength="1" type="text" inputmode="numeric">
                <input class="code-input" maxlength="1" type="text" inputmode="numeric">
                <input class="code-input" maxlength="1" type="text" inputmode="numeric">
            </div>
            <div id="verifyErr" style="display:none; color:var(--danger); font-size:0.85rem; margin-bottom: 1rem;">
            </div>
            <button class="btn-primary" id="verifyBtn">VERIFY & CONFIGURE</button>
        </div>
    </div>

    <div class="auth-container">
        <div class="auth-card glass-card">
            <div class="brand">
                <div class="brand-logo"><i class="fas fa-crosshairs"></i></div>
                <h1>XP ARENA</h1>
            </div>

            <div class="auth-header">
                <h2>Join the Elite</h2>
                <p>Initialize your Areni identity matrix</p>
            </div>

            <div id="errorBox"
                style="display:none; background:rgba(239, 68, 68, 0.1); border:1px solid var(--danger); padding:1rem; border-radius:12px; margin-bottom:1.5rem; color:var(--danger); font-size:0.9rem;">
            </div>

            <form id="signupForm" autocomplete="off">
                <div class="field">
                    <label>Areni Username</label>
                    <div class="input-wrap">
                        <i class="fas fa-user"></i>
                        <input type="text" id="username" placeholder="Enter Tag" required>
                    </div>
                </div>

                <div class="field">
                    <label>Email Address</label>
                    <div class="input-wrap">
                        <i class="fas fa-envelope"></i>
                        <input type="email" id="email" placeholder="name@arena.com" required>
                    </div>
                </div>

                <div class="field">
                    <label>Security Key</label>
                    <div class="input-wrap">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="password" placeholder="Min. 6 characters" required>
                    </div>
                    <div class="strength-bar">
                        <div class="strength-fill" id="strengthFill"></div>
                    </div>
                    <div class="strength-label" id="strengthLabel">Enter a password</div>
                </div>

                <div style="margin: 2rem 0; display: flex; align-items: flex-start; gap: 12px; text-align: left;">
                    <input type="checkbox" id="terms" required style="margin-top: 4px;">
                    <label for="terms" style="font-size: 0.85rem; color: var(--text-muted); line-height: 1.4;">
                        I acknowledge the <a href="#">Terms of Engagement</a> and Privacy Protocol.
                    </label>
                </div>

                <button type="submit" class="btn-primary" id="signupBtn">INITIALIZE ACCOUNT</button>
            </form>

            <div class="auth-footer">
                Already an Areni? <a href="login.html">Log in here</a>
            </div>
        </div>
    </div>
    </main>
    <nav class="bottom-nav"></nav>
    <script src="js/auth.js"></script>
    <script src="js/user.js"></script>
    <script src="js/layout.js"></script>
    <script src="js/app.js"></script>
    <script>
        document.getElementById('pwToggle').addEventListener('click', () => {
            const inp = document.getElementById('password'); const ico = document.querySelector('#pwToggle i');
            inp.type = inp.type === 'password' ? 'text' : 'password'; ico.className = inp.type === 'password' ? 'fas fa-eye-slash' : 'fas fa-eye';
        });
        document.getElementById('password').addEventListener('input', function () {
            const v = this.value; const fill = document.getElementById('strengthFill'); const label = document.getElementById('strengthLabel');
            let score = 0; if (v.length >= 6) score++; if (v.length >= 10) score++; if (/[A-Z]/.test(v)) score++; if (/[0-9]/.test(v)) score++; if (/[^A-Za-z0-9]/.test(v)) score++;
            const cfg = [{ w: '0%', bg: 'transparent', t: 'Enter a password' }, { w: '20%', bg: '#ef4444', t: 'Weak' }, { w: '40%', bg: '#f97316', t: 'Fair' }, { w: '60%', bg: '#f59e0b', t: 'Okay' }, { w: '80%', bg: '#84cc16', t: 'Strong' }, { w: '100%', bg: '#10b981', t: 'Elite ðŸ”¥' }];
            const c = cfg[score] || cfg[0]; fill.style.width = c.w; fill.style.background = c.bg; label.textContent = c.t;
        });
        let pendingUser = '';
        const codeInputs = document.querySelectorAll('.code-input');
        codeInputs.forEach((inp, i) => {
            inp.addEventListener('input', () => { if (inp.value && i < codeInputs.length - 1) codeInputs[i + 1].focus(); });
            inp.addEventListener('keydown', e => { if (e.key === 'Backspace' && !inp.value && i > 0) codeInputs[i - 1].focus(); });
        });
        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault(); const errBox = document.getElementById('errorBox'); const btn = document.getElementById('signupBtn');
            errBox.style.display = 'none'; btn.disabled = true; btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> ENROLLING...';
            const username = document.getElementById('username').value.trim(); const email = document.getElementById('email').value.trim(); const password = document.getElementById('password').value;
            try {
                const res = await fetch((window.API_URL || '') + '/api/auth/register', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username, email, password }) });
                const data = await res.json();
                if (res.ok && data.success) { pendingUser = username; document.getElementById('verifyOverlay').classList.add('active'); document.querySelector('.code-input').focus(); }
                else throw new Error(data.error || 'Failed');
            } catch (err) { errBox.textContent = err.message; errBox.style.display = 'block'; } finally { btn.disabled = false; btn.innerHTML = 'INITIALIZE ACCOUNT'; }
        });
        document.getElementById('verifyBtn').addEventListener('click', async () => {
            const code = Array.from(codeInputs).map(i => i.value).join('') || '000000';
            const vBtn = document.getElementById('verifyBtn'); vBtn.disabled = true; vBtn.innerHTML = 'VERIFYING...';
            try {
                const res = await fetch((window.API_URL || '') + '/api/auth/verify-email', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username: pendingUser, code }) });
                const data = await res.json();
                if (res.ok && data.success) { localStorage.setItem('xp_token', data.token); localStorage.setItem('xp_current_user', JSON.stringify(data.user)); window.location.href = 'profile.html'; }
                else throw new Error(data.error || 'Failed');
            } catch (err) { document.getElementById('verifyErr').textContent = err.message; document.getElementById('verifyErr').style.display = 'block'; vBtn.disabled = false; vBtn.innerHTML = 'VERIFY & ENTER'; }
        });
    </script>
</body>

</html>