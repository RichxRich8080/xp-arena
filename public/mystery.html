<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neural Anomaly â€¢ XP ARENA</title>
    <link rel="stylesheet" href="css/rebirth.css">
    <link rel="stylesheet" href="assets/fontawesome/css/all.min.css">
    <style>
        :root {
            --mystery-accent: #ff00ff;
            --mystery-glow: rgba(255, 0, 255, 0.2);
        }

        body.page-mystery {
            background-color: #050505;
            overflow: hidden;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .terminal-shell {
            width: 90%;
            max-width: 900px;
            height: 70vh;
            padding: 3rem;
            position: relative;
            background: rgba(10, 5, 10, 0.8);
            border-color: var(--mystery-accent);
            box-shadow: 0 0 40px var(--mystery-glow);
            overflow: hidden;
        }

        .terminal-content {
            height: 100%;
            overflow-y: auto;
            font-family: 'Share Tech Mono', monospace;
            color: var(--mystery-accent);
            text-shadow: 0 0 5px var(--mystery-glow);
            font-size: 1rem;
            line-height: 1.6;
        }

        .output-line {
            margin-bottom: 0.5rem;
            opacity: 0;
            animation: fadeIn 0.3s forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        .input-line {
            display: flex;
            gap: 15px;
            margin-top: 1.5rem;
        }

        .prompt {
            color: #fff;
            opacity: 0.7;
        }

        .cmd-input {
            background: transparent;
            border: none;
            color: var(--mystery-accent);
            font-family: inherit;
            font-size: 1rem;
            width: 100%;
            outline: none;
        }

        .reward-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            text-align: center;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }

        .reward-token {
            font-size: 4rem;
            color: #fff;
            text-shadow: 0 0 20px var(--mystery-accent);
            margin: 2rem 0;
            font-family: 'Clash Display', sans-serif;
        }

        .glitch-static {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://media.giphy.com/media/oEI9uWUicGk58pLRE7/giphy.gif');
            opacity: 0.03;
            pointer-events: none;
            z-index: 1000;
        }
    </style>
</head>

<body class="page-rebirth page-mystery">
    <div class="glitch-static"></div>

    <div class="pulse-card terminal-shell">
        <div class="terminal-content" id="output">
            <!-- Boot sequence injected by JS -->
        </div>

        <div class="input-line" id="inputContainer" style="display: none;">
            <span class="prompt">areni@anomaly:~$</span>
            <input type="text" id="cmdInput" class="cmd-input" autocomplete="off" autofocus>
        </div>

        <div class="reward-overlay" id="reward">
            <h1 class="clash" style="color: var(--mystery-accent);">ANOMALY STABILIZED</h1>
            <p style="color: var(--stardust-muted);">You have accessed a restricted neural sector.</p>
            <div class="reward-token">+500 AXP</div>
            <button class="btn-rebirth" style="border-color: var(--mystery-accent); color: #fff;"
                onclick="window.location.href='profile.html'">
                RETURN TO HUB
            </button>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/user.js"></script>
    <script src="js/layout.js"></script>
    <script>
        const output = document.getElementById('output');
        const inputContainer = document.getElementById('inputContainer');
        const cmdInput = document.getElementById('cmdInput');

        const protocols = [
            { cmd: 'decrypt', target: 'X-77', desc: 'KERNEL ENCRYPTION DETECTED' },
            { cmd: 'find', target: 'PIXEL-0', desc: 'HIDDEN FRAGMENT LOCATED' },
            { cmd: 'bypass', target: 'VOID-WALL', desc: 'VULNERABILITY FOUND' }
        ];
        const currentProto = protocols[new Date().getDate() % protocols.length];

        const bootSequence = [
            "> INITIALIZING NEURAL UPLINK...",
            "> BYPASSING STANDARD AUTHENTICATION...",
            "> ACCESSING RESTRICTED HIVE-MIND SECTOR...",
            `> WARNING: ${currentProto.desc}`,
            `> EXECUTE '${currentProto.cmd}' TO ENGAGE ${currentProto.target}...`,
            " "
        ];

        let delay = 0;
        bootSequence.forEach((line, i) => {
            setTimeout(() => {
                const div = document.createElement('div');
                div.className = 'output-line';
                div.textContent = line;
                output.appendChild(div);
                if (i === bootSequence.length - 1) {
                    inputContainer.style.display = 'flex';
                    cmdInput.focus();
                }
            }, delay);
            delay += 600;
        });

        cmdInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const val = cmdInput.value.trim().toLowerCase();
                const div = document.createElement('div');
                div.className = 'output-line';
                div.textContent = `areni@anomaly:~$ ${cmdInput.value}`;
                output.appendChild(div);
                cmdInput.value = '';

                if (val === currentProto.cmd) {
                    triggerSuccess();
                } else if (val === 'help') {
                    out("VOLATILE COMMANDS: help, ls, clear, whoami, system, " + currentProto.cmd);
                } else if (val === 'ls') {
                    out("root/  etc/  vault/  anomaly_logs/  secret_data/");
                } else if (val === 'clear') {
                    output.innerHTML = '';
                } else if (val === 'whoami') {
                    out(`IDENTITY: ${Auth.isLoggedIn() ? Auth.getCurrentUser().username : 'GHOST_ARENI'}`);
                } else if (val === 'system') {
                    out("OS: REBIRTH_KERNEL v0.9.9");
                    out("CPU: NEURAL_CHIPSET_8080");
                    out("LOC: UNDEFINED_SECTOR");
                } else {
                    out(`UNRECOGNIZED SIGNAL: ${val}`, '#ff4444');
                }
                output.scrollTop = output.scrollHeight;
            }
        });

        function out(text, color) {
            const d = document.createElement('div');
            d.className = 'output-line';
            if (color) d.style.color = color;
            d.textContent = "> " + text;
            output.appendChild(d);
        }

        async function triggerSuccess() {
            out("ENGAGING PROTOCOL...", '#ff00ff');
            setTimeout(async () => {
                document.getElementById('reward').style.display = 'flex';
                if (Auth.isLoggedIn()) {
                    try {
                        const res = await fetch('/api/user/daily-protocol', {
                            method: 'POST',
                            headers: { 'Authorization': 'Bearer ' + Auth.getToken() }
                        });
                        const data = await res.json();
                    } catch (e) { }
                }
            }, 1000);
        }
    </script>
</body>

</html>